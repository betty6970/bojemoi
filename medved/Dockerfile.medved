FROM python:3.12-slim

WORKDIR /app

RUN apt-get update && apt-get install -y --no-install-recommends openssh-client && rm -rf /var/lib/apt/lists/*

COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# Pre-generate SSH host key at build time
RUN ssh-keygen -t rsa -b 2048 -f /app/ssh_host_key -N '' -q

COPY honeypot/ honeypot/

EXPOSE 2222 8080 3389 445 2121 2323 9200

CMD ["python", "-m", "honeypot.main"]
